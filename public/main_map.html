<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">     
    <meta http-equiv="X-UA-Compatible" content="IE=edge">     
    <meta name="viewport" content="width=device-width, initial-scale=1">    
    <title>Explore</title>
    <link rel="stylesheet" href="CSS/common.css" media="all">
    <script src="js/common.js"></script>
    <link rel="stylesheet" href="CSS/main_map.css" media="all">


    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAkK5NajaFKNXkYT2WsdB96edSWRo5kYhY&callback=initMap" async defer></script>
    
    <script>

      

    


      var map;
     
      function initMap() {
          //new map
          map = new google.maps.Map(document.getElementById('map'), {
              center: {lat: 25.033499866, lng: 121.558997764},
              zoom: 15,
              options: {
                clickableIcons: true
              },
              styles: [
                {"elementType":"labels","stylers":[{"visibility":"on"}]},  //到時候要把這調成 off
                {"featureType": "road","elementType": "labels","stylers":[{"visibility":"on"}]},
                {"featureType": "transit.station","elementType": "labels","stylers":[{"visibility":"on"}]},
                {"featureType": "transit.station.bus","elementType": "labels","stylers":[{"visibility":"on"}]},
                {"featureType": "water","elementType": "labels","stylers":[{"visibility":"on"}]}
              ]
          });
          


          var xhr = new XMLHttpRequest();

          xhr.open("GET", `/api/map`,true);
          xhr.onreadystatechange=function() {
            if (this.readyState == 4 && this.status == 200) {
              let all_markers = JSON.parse(xhr.responseText);
              console.log(all_markers);


              // all_marker_data
              for (let i = 0 ; i<all_markers.length ;i++){
              
                var marker = new google.maps.Marker({
                      position:{lat: all_markers[i].latitude, lng: all_markers[i].longitude},
                      map:map
                  });
                marker.content = `
                      <h1>${all_markers[i].name}</h1>
                      <p>${all_markers[i].information}</p>
                      `;

                var infoWindow = new google.maps.InfoWindow();
                google.maps.event.addListener(marker, 'click', function () {
                  infoWindow.setContent(this.content);
                  infoWindow.open(this.getMap(), this);
                });

              }




            }
          }
          xhr.send();




      }

    </script>

</head>
<body>
  <div class = "main">
    <nav>
      <div>
        <a href="/" >
          <p class="Logo">mapBook</p>
        </a>
      </div>
      <div>
        <ul>
            <li class="nav_item"><a href="/">About</a></li>
            <li class="nav_item"><a href="/main_map.html">Explore</a></li>
            <li class="nav_item" onclick="signin_or_profile()"><a>User</a></li>
        </ul>
      </div>
    </nav>

    <div class = "search_and_edit_bar">

    </div>
    
    <div class = "public_map">

      <div class= "search_and_list">
        <div class = "search_list_bar">

        </div>
        <div class = "search_list_result">

        </div>

        <div class = "user_own_list">

        </div>
      </div>

      <div id="map">
      </div>

    

    </div>

    <footer>
        <div class="footer_bar">
          <div class="copyright">
              <p>© 2019. All rights reserved.</p>
          </div>
        </div>
    </footer>
  </div>
      
      
    

</body>



</html> 